name: Jan Build Electron App Nightly

on:
  schedule:
    - cron: '0 20 * * 2,3,4' # At 8 PM UTC on Tuesday, Wednesday, and Thursday, which is 3 AM UTC+7

jobs:
  # Get condition to upload to cloudflare re
  # get-condition-to-upload-cloudflare-r2:
  #   runs-on: ubuntu-latest
  #   outputs:
  #     condition: ${{ steps.get-condition-to-upload-cloudflare-r2.outputs.condition }}
  #   steps:
  #     - name: Get condition to upload to cloudflare re
  #       id: get-condition-to-upload-cloudflare-r2
  #       run: |
  #         if [ "${{ github.event_name }}" == "schedule" ]; then
  #           echo "::set-output name=condition::true"
  #         else
  #           echo "::set-output name=condition::false"
  #         fi

  # Job create Update app version based on latest release tag with build number and save to output
  get-update-version:
    uses: ./.github/workflows/template-get-update-version.yml

  build-macos:
    uses: ./.github/workflows/template-build-macos.yml
    needs: [get-update-version]
    secrets: inherit
    with:
      ref: refs/heads/dev
      upload_cloudflare_r2: true
      new_version: ${{ needs.get-update-version.outputs.new_version }}

  build-windows-x64:
    uses: ./.github/workflows/template-build-windows-x64.yml
    secrets: inherit
    needs: [get-update-version]
    with:
      ref: refs/heads/dev
      upload_cloudflare_r2: true
      new_version: ${{ needs.get-update-version.outputs.new_version }}

          
  build-linux-x64:
    uses: ./.github/workflows/template-build-linux-x64.yml
    secrets: inherit
    needs: [get-update-version]
    with:
      ref: refs/heads/dev
      upload_cloudflare_r2: true
      new_version: ${{ needs.get-update-version.outputs.new_version }}

  noti-discord-nightly-and-update-url-readme:
    needs: [build-macos, build-windows-x64, build-linux-x64, get-update-version]
    secrets: inherit
    if: github.event_name == 'schedule'
    uses: ./.github/workflows/template-noti-discord-and-update-url-readme.yml
    with:
      ref: refs/heads/dev
      build_reason: Nightly
      push_to_branch: main
      new_version: ${{ needs.get-update-version.outputs.new_version }}
